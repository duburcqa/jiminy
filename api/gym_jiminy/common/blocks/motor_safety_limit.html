

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Motor Safety Limit &mdash; jiminy 1.8.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/documentation_options.js?v=32cf9813"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Mahony Filter" href="mahony_filter.html" />
    <link rel="prev" title="Proportional Derivative Controller" href="proportional_derivative_controller.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            jiminy
              <img src="../../../../_static/jiminy_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">README</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Key features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#gym-jiminy">Gym Jiminy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#demo">Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#getting-started">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html">Easy-install on Ubuntu 18+</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html#building-from-source">Building from source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">An introduction to Jiminy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API DOC</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../jiminy/index.html">Jiminy C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jiminy_py/index.html">Jiminy Python API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Gym Jiminy API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bases/index.html">Bases</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Blocks</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="proportional_derivative_controller.html">Proportional Derivative Controller</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Motor Safety Limit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gym_jiminy.common.blocks.motor_safety_limit.apply_safety_limits"><code class="docutils literal notranslate"><span class="pre">apply_safety_limits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit"><code class="docutils literal notranslate"><span class="pre">MotorSafetyLimit</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mahony_filter.html">Mahony Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="body_orientation_observer.html">Body Orientation State Observation</a></li>
<li class="toctree-l3"><a class="reference internal" href="deformation_estimator.html">Deformation Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="quantity_observer.html">Generic Quantity Observer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../envs/index.html">Envs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quantities/index.html">Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compositions/index.html">Compositions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wrappers/index.html">Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html">Utils</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Specifications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/src/tlmc_format_specification.html">HDF5 telemetry log format (TLMC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/pdf/index.html">Downloadable PDF</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">jiminy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Gym Jiminy API</a></li>
          <li class="breadcrumb-item"><a href="index.html">Blocks</a></li>
      <li class="breadcrumb-item active">Motor Safety Limit</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/api/gym_jiminy/common/blocks/motor_safety_limit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-gym_jiminy.common.blocks.motor_safety_limit">
<span id="motor-safety-limit"></span><h1>Motor Safety Limit<a class="headerlink" href="#module-gym_jiminy.common.blocks.motor_safety_limit" title="Link to this heading">¶</a></h1>
<p>Implementation of basic Proportional-Derivative controller block compatible
with gym_jiminy reinforcement learning pipeline environment design.</p>
<dl class="py function">
<dt class="sig sig-object py" id="gym_jiminy.common.blocks.motor_safety_limit.apply_safety_limits">
<span class="sig-prename descclassname"><span class="pre">gym_jiminy.common.blocks.motor_safety_limit.</span></span><span class="sig-name descname"><span class="pre">apply_safety_limits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_measured</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_measured</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">motors_soft_position_lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">motors_soft_position_upper</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">motors_velocity_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">motors_effort_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/blocks/motor_safety_limit.html#apply_safety_limits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.blocks.motor_safety_limit.apply_safety_limits" title="Link to this definition">¶</a></dt>
<dd><p>Clip the command torque to ensure safe operation.</p>
<p>It acts on each actuator independently and only activate close to the
position or velocity limits. Basically, the idea to the avoid moving faster
when some prescribed velocity limit or exceeding soft position bounds by
forcing the command torque to act against it. Still, it may not be enough
to prevent such issue in practice as the command torque is bounded.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All the input arguments must be in motor order, including the measured
position and velocity of the actuators. In practice, those measurements
comes from the encoder sensors. If so, then the measurements must be
re-ordered if necessary to match motor order instead of sensor order.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <cite>MotorSafetyLimit</cite> documentation for details.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>command</strong> (<em>ndarray</em>) – Desired command to will be updated in-place if necessary.</p></li>
<li><p><strong>q_measured</strong> (<em>ndarray</em>) – Current position of the actuators.</p></li>
<li><p><strong>v_measured</strong> (<em>ndarray</em>) – Current velocity of the actuators.</p></li>
<li><p><strong>kp</strong> (<em>ndarray</em>) – Scale of the velocity bound triggered by position limits.</p></li>
<li><p><strong>kd</strong> (<em>ndarray</em>) – Scale of the effort bound triggered by velocity limits.</p></li>
<li><p><strong>motors_soft_position_lower</strong> (<em>ndarray</em>) – Soft lower position limit of the actuators.</p></li>
<li><p><strong>motors_soft_position_upper</strong> (<em>ndarray</em>) – Soft upper position limit of the actuators.</p></li>
<li><p><strong>motors_velocity_limit</strong> (<em>ndarray</em>) – Maximum velocity of the actuators.</p></li>
<li><p><strong>motors_effort_limit</strong> (<em>ndarray</em>) – Maximum effort that the actuators can output.
The command torque cannot exceed this limits,
not even if needed to enforce safe operation.</p></li>
<li><p><strong>out</strong> (<em>ndarray</em>) – Pre-allocated memory to store the command motor torques.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gym_jiminy.common.blocks.motor_safety_limit.</span></span><span class="sig-name descname"><span class="pre">MotorSafetyLimit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft_position_margin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft_velocity_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft_effort_rel_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/blocks/motor_safety_limit.html#MotorSafetyLimit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../bases/blocks.html#gym_jiminy.common.bases.blocks.BaseControllerBlock" title="gym_jiminy.common.bases.blocks.BaseControllerBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseControllerBlock</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseObs</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
<p>Safety mechanism primarily designed to prevent hardware damage and
premature wear, but also to temper violent, sporadic and dangerous motions.</p>
<p>A velocity limit v+ is enforced by bounding the commanded effort such that
no effort can be applied to push the joint beyond the velocity limit, and
a damping effort is applied if the joint is moving at a velocity beyond
the limit, ie -kd * (v - v+).</p>
<p>When the joint is near the soft limits x+/-, the velocities are bounded to
keep the position from crossing the soft limits. The k_position term
determines the scale of the bound on velocity, ie v+/- = -kp * (x - x+/-).
These bounds on velocity are the ones determining the bounds on effort.</p>
<p>The output command would never exceed the maximum effort, not even if
needed to enforce safe operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The prescribed position and velocity limits may be more respective that
the actual hardware specification of the robot.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It must be connected directly to the environment without any other
intermediary controller.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See official ROS documentation and implementation for details:
<a class="reference external" href="https://wiki.ros.org/pr2_controller_manager/safety_limits">https://wiki.ros.org/pr2_controller_manager/safety_limits</a>
<a class="reference external" href="https://github.com/PR2/pr2_mechanism/blob/melodic-devel/pr2_mechanism_model/src/joint.cpp">https://github.com/PR2/pr2_mechanism/blob/melodic-devel/pr2_mechanism_model/src/joint.cpp</a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Name of the block.</p></li>
<li><p><strong>env</strong> (<a class="reference internal" href="../bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv" title="gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv"><em>InterfaceJiminyEnv</em></a><em>[</em><em>BaseObs</em><em>, </em><em>BaseAct</em><em>]</em>) – Environment to connect with.</p></li>
<li><p><strong>kp</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Scale of the velocity bound triggered by position limits.</p></li>
<li><p><strong>kd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Scale of the effort bound triggered by velocity limits.</p></li>
<li><p><strong>soft_position_margin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Minimum distance of the current joint
positions from their respective bounds
before starting to break.</p></li>
<li><p><strong>soft_velocity_max</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Maximum velocity of the joint before
starting to break.</p></li>
<li><p><strong>soft_effort_rel_max</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Maximum effort of the motor before
applying artificial saturation on it. This
limitation is ignored in evaluation mode.
Optional: 1.0 by default.</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit.fieldnames">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fieldnames</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit.fieldnames" title="Link to this definition">¶</a></dt>
<dd><p>Get mapping between each scalar element of the action space of
the controller block and the associated fieldname for logging.</p>
<p>It is expected to return an object with the same structure than the
action space, but having lists of string as leaves. Generic fieldnames
are used by default.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit.compute_command">
<span class="sig-name descname"><span class="pre">compute_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/blocks/motor_safety_limit.html#MotorSafetyLimit.compute_command"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.blocks.motor_safety_limit.MotorSafetyLimit.compute_command" title="Link to this definition">¶</a></dt>
<dd><p>Apply safety limits to the desired motor torques right before
sending it to the robot so as to avoid exceeded prescribed position
and velocity limits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> (<em>ndarray</em>) – Desired motor torques to apply on the robot.</p></li>
<li><p><strong>command</strong> (<em>ndarray</em>) – Current motor torques that will be updated in-place.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="proportional_derivative_controller.html" class="btn btn-neutral float-left" title="Proportional Derivative Controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mahony_filter.html" class="btn btn-neutral float-right" title="Mahony Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Alexis Duburcq - MIT licence.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>