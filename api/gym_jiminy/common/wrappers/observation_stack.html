

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Observation Frame Stacking &mdash; jiminy 1.8.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/documentation_options.js?v=32cf9813"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Utils" href="../utils/index.html" />
    <link rel="prev" title="Observation Layout Adaptation" href="observation_layout.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            jiminy
              <img src="../../../../_static/jiminy_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">README</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Key features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#gym-jiminy">Gym Jiminy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#demo">Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#getting-started">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html">Easy-install on Ubuntu 18+</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html#building-from-source">Building from source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">An introduction to Jiminy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API DOC</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../jiminy/index.html">Jiminy C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jiminy_py/index.html">Jiminy Python API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Gym Jiminy API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bases/index.html">Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../envs/index.html">Envs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quantities/index.html">Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compositions/index.html">Compositions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Wrappers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="flatten.html">Flattening</a></li>
<li class="toctree-l3"><a class="reference internal" href="scale.html">Scaling and normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="observation_layout.html">Observation Layout Adaptation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Observation Frame Stacking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gym_jiminy.common.wrappers.observation_stack.StackObservation"><code class="docutils literal notranslate"><span class="pre">StackObservation</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html">Utils</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Specifications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/src/tlmc_format_specification.html">HDF5 telemetry log format (TLMC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/pdf/index.html">Downloadable PDF</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">jiminy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Gym Jiminy API</a></li>
          <li class="breadcrumb-item"><a href="index.html">Wrappers</a></li>
      <li class="breadcrumb-item active">Observation Frame Stacking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/api/gym_jiminy/common/wrappers/observation_stack.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-gym_jiminy.common.wrappers.observation_stack">
<span id="observation-frame-stacking"></span><h1>Observation Frame Stacking<a class="headerlink" href="#module-gym_jiminy.common.wrappers.observation_stack" title="Link to this heading">¶</a></h1>
<p>This module implements a wrapper for stacking observations over time.</p>
<p>This wrapper</p>
<dl class="py class">
<dt class="sig sig-object py" id="gym_jiminy.common.wrappers.observation_stack.StackObservation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gym_jiminy.common.wrappers.observation_stack.</span></span><span class="sig-name descname"><span class="pre">StackObservation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_stack</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nested_filter_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_frames_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/wrappers/observation_stack.html#StackObservation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.wrappers.observation_stack.StackObservation" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../bases/pipeline.html#gym_jiminy.common.bases.pipeline.BasePipelineWrapper" title="gym_jiminy.common.bases.pipeline.BasePipelineWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasePipelineWrapper</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedObs</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Act</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedObs</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Act</span></code>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedObs</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Act</span></code>]</p>
<p>Partially stack observations in a rolling manner.</p>
<p>This wrapper combines and extends OpenAI Gym wrappers <cite>FrameStack</cite> and
<cite>FilteredJiminyEnv</cite> to support nested filter keys. It derives from
<cite>BasePipelineWrapper</cite> rather than <cite>gym.Wrapper</cite>. This means that
observations can be stacked at observation update period rather than step
update period. It is also possible to access the stacked observation from
any block of the environment pipeline, and it will be taken into account
when calling <cite>evaluate</cite> or <cite>play_interactive</cite>.</p>
<p>It adds one extra dimension to all the leaves of the original observation
spaces that must be stacked. In such a case, the first dimension
corresponds to the individual timesteps (from oldest <cite>0</cite> to latest <cite>-1</cite>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The standard container spaces <cite>gym.spaces.Dict</cite> and <cite>gym.spaces.Tuple</cite>
are both supported. All the stacked leaf spaces must have type
<cite>gym.spaces.Box</cite>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The latest frame of the stacked leaf observations corresponds to their
latest respective values no matter what. It will frozen when shifted to
the left.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>env</strong> (<a class="reference internal" href="../bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv" title="gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv"><em>InterfaceJiminyEnv</em></a><em>[</em><em>NestedObs</em><em>, </em><em>Act</em><em>]</em>) – Environment to wrap.</p></li>
<li><p><strong>num_stack</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – Number of observation frames to keep stacked.</p></li>
<li><p><strong>nested_filter_keys</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><em>Sequence</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><em>Sequence</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>] </em><em>| </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>] </em><em>| </em><em>None</em>) – List of nested observation paths to stack.
If a nested path is not associated with a
leaf, then every leaves starting from this
root path will be stacked.
Optional: All leaves will be stacked by
default.</p></li>
<li><p><strong>skip_frames_ratio</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – Number of observation refresh to skip between
each update of the stacked leaf values. -1 to
update only once per environment step.
Optional: -1 by default.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="gym_jiminy.common.wrappers.observation_stack.StackObservation.refresh_observation">
<span class="sig-name descname"><span class="pre">refresh_observation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">measurement</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/wrappers/observation_stack.html#StackObservation.refresh_observation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.wrappers.observation_stack.StackObservation.refresh_observation" title="Link to this definition">¶</a></dt>
<dd><p>Compute observed features based on the current simulation state and
lower-level measure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>measurement</strong> (<a class="reference internal" href="../bases/interfaces.html#gym_jiminy.common.bases.interfaces.EngineObsType" title="gym_jiminy.common.bases.interfaces.EngineObsType"><em>EngineObsType</em></a>) – Low-level measure from the environment to process
to get higher-level observation.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gym_jiminy.common.wrappers.observation_stack.StackObservation.compute_command">
<span class="sig-name descname"><span class="pre">compute_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gym_jiminy/common/wrappers/observation_stack.html#StackObservation.compute_command"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gym_jiminy.common.wrappers.observation_stack.StackObservation.compute_command" title="Link to this definition">¶</a></dt>
<dd><p>Compute the motors efforts to apply on the robot.</p>
<p>It simply forwards the command computed by the wrapped environment
without any processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> (<em>Act</em>) – High-level target to achieve by means of the command.</p></li>
<li><p><strong>command</strong> (<em>ndarray</em>) – Lower-level command to updated in-place.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>None</em></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="observation_layout.html" class="btn btn-neutral float-left" title="Observation Layout Adaptation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../utils/index.html" class="btn btn-neutral float-right" title="Utils" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Alexis Duburcq - MIT licence.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>