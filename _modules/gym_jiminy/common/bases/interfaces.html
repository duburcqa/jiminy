

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gym_jiminy.common.bases.interfaces &mdash; jiminy 1.8.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/documentation_options.js?v=32cf9813"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            jiminy
              <img src="../../../../_static/jiminy_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">README</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Key features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#gym-jiminy">Gym Jiminy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#demo">Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#getting-started">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html">Easy-install on Ubuntu 18+</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html#building-from-source">Building from source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">An introduction to Jiminy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API DOC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/jiminy/index.html">Jiminy C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/jiminy_py/index.html">Jiminy Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/gym_jiminy/common/index.html">Gym Jiminy API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Specifications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/src/tlmc_format_specification.html">HDF5 telemetry log format (TLMC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/pdf/index.html">Downloadable PDF</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">jiminy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">gym_jiminy.common.bases.interfaces</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gym_jiminy.common.bases.interfaces</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Controller and observer abstract interfaces from reinforcement learning,</span>
<span class="sd">specifically design for Jiminy engine, and defined as mixin classes. Any</span>
<span class="sd">observer/controller block must inherit and implement those interfaces.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span><span class="p">,</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span> <span class="n">SupportsFloat</span><span class="p">,</span> <span class="n">no_type_check</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">import</span> <span class="nn">gymnasium</span> <span class="k">as</span> <span class="nn">gym</span>

<span class="kn">import</span> <span class="nn">jiminy_py.core</span> <span class="k">as</span> <span class="nn">jiminy</span>
<span class="kn">from</span> <span class="nn">jiminy_py.core</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># pylint: disable=no-name-in-module</span>
    <span class="n">multi_array_copyto</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">jiminy_py.simulator</span> <span class="kn">import</span> <span class="n">Simulator</span><span class="p">,</span> <span class="n">TabbedFigure</span>
<span class="kn">from</span> <span class="nn">jiminy_py.viewer.viewer</span> <span class="kn">import</span> <span class="n">is_display_available</span>

<span class="kn">import</span> <span class="nn">pinocchio</span> <span class="k">as</span> <span class="nn">pin</span>

<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">FieldNested</span><span class="p">,</span> <span class="n">DataNested</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..envs.generic</span> <span class="kn">import</span> <span class="n">BaseJiminyEnv</span>
    <span class="kn">from</span> <span class="nn">..quantities</span> <span class="kn">import</span> <span class="n">QuantityManager</span>


<span class="c1"># Temporal resolution of simulator steps</span>
<span class="n">DT_EPS</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># &#39;SIMULATION_MIN_TIMESTEP&#39;</span>


<span class="n">Obs</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Obs&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">DataNested</span><span class="p">)</span>
<span class="n">Act</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Act&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">DataNested</span><span class="p">)</span>
<span class="n">BaseObs</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;BaseObs&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">DataNested</span><span class="p">)</span>
<span class="n">BaseAct</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;BaseAct&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">DataNested</span><span class="p">)</span>

<span class="n">SensorMeasurementStackMap</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
<span class="n">InfoType</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

<span class="n">PolicyCallbackFun</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span>
    <span class="p">[</span><span class="n">Obs</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Act</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">InfoType</span><span class="p">],</span> <span class="n">Act</span><span class="p">]</span>


<div class="viewcode-block" id="EngineObsType">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.EngineObsType">[docs]</a>
<span class="k">class</span> <span class="nc">EngineObsType</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raw observation provided by Jiminy Core Engine prior to any</span>
<span class="sd">    post-processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Current simulation time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">states</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataNested</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State of the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">measurements</span><span class="p">:</span> <span class="n">SensorMeasurementStackMap</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sensor measurements. Individual data for each sensor are aggregated by</span>
<span class="sd">    types in 2D arrays whose first dimension gathers the measured components</span>
<span class="sd">    and second dimension corresponds to individual measurements sorted by</span>
<span class="sd">    sensor indices.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="InterfaceObserver">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceObserver">[docs]</a>
<span class="k">class</span> <span class="nc">InterfaceObserver</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">Obs</span><span class="p">,</span> <span class="n">BaseObs</span><span class="p">],</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Observer interface for both observers and environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">observe_dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">[</span><span class="n">Obs</span><span class="p">]</span>
    <span class="n">observation</span><span class="p">:</span> <span class="n">Obs</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the observer interface.</span>

<span class="sd">        :param args: Extra arguments that may be useful for mixing</span>
<span class="sd">                     multiple inheritance through multiple inheritance.</span>
<span class="sd">        :param kwargs: Extra keyword arguments. See &#39;args&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super to allow mixing interfaces through multiple inheritance</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Refresh the observation space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_observation_space</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_initialize_observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the observation space.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceObserver.refresh_observation">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceObserver.refresh_observation">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">refresh_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement</span><span class="p">:</span> <span class="n">BaseObs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute observed features based on the current simulation state and</span>
<span class="sd">        lower-level measure.</span>

<span class="sd">        .. warning:</span>
<span class="sd">            When overloading this method, one is expected to use the internal</span>
<span class="sd">            buffer `observation` to store the observation by updating it by</span>
<span class="sd">            reference. It may be error prone and tricky to get use to it, but</span>
<span class="sd">            it is computationally more efficient as it avoids allocating memory</span>
<span class="sd">            multiple times and redundant calculus.</span>

<span class="sd">        :param measurement: Low-level measure from the environment to process</span>
<span class="sd">                            to get higher-level observation.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
</div>



<div class="viewcode-block" id="InterfaceController">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceController">[docs]</a>
<span class="k">class</span> <span class="nc">InterfaceController</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">Act</span><span class="p">,</span> <span class="n">BaseAct</span><span class="p">],</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Controller interface for both controllers and environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">[</span><span class="n">Act</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the controller interface.</span>

<span class="sd">        :param args: Extra arguments that may be useful for mixing</span>
<span class="sd">                     multiple inheritance through multiple inheritance.</span>
<span class="sd">        :param kwargs: Extra keyword arguments. See &#39;args&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super to allow mixing interfaces through multiple inheritance</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Refresh the action space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_action_space</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_initialize_action_space</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the action space.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceController.compute_command">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceController.compute_command">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">compute_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Act</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">BaseAct</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the command to send to the subsequent block, based on the</span>
<span class="sd">        action and current observation of the environment.</span>

<span class="sd">        .. note::</span>
<span class="sd">            By design, the observation of the environment has been refreshed</span>
<span class="sd">            automatically prior to calling this method.</span>

<span class="sd">        :param action: High-level target to achieve by means of the command.</span>
<span class="sd">        :param command: Command to send to the subsequent block. It corresponds</span>
<span class="sd">                        to the target features of another lower-level</span>
<span class="sd">                        controller if any, the target motors efforts of the</span>
<span class="sd">                        environment to ultimately control otherwise. It must be</span>
<span class="sd">                        updated in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceController.compute_reward">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceController.compute_reward">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">terminated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
                       <span class="n">info</span><span class="p">:</span> <span class="n">InfoType</span>  <span class="c1"># pylint: disable=unused-argument</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the reward related to a specific control block, plus extra</span>
<span class="sd">        information that may be helpful for monitoring or debugging purposes.</span>

<span class="sd">        For the corresponding MDP to be stationary, the computation of the</span>
<span class="sd">        reward is supposed to involve only the transition from previous to</span>
<span class="sd">        current state of the simulation (possibly comprising multiple agents)</span>
<span class="sd">        under the ongoing action.</span>

<span class="sd">        By default, it returns 0.0 without extra information no matter what.</span>
<span class="sd">        The user is expected to provide an appropriate reward on its own,</span>
<span class="sd">        either by overloading this method or by wrapping the environment with</span>
<span class="sd">        `ComposedJiminyEnv` for modular environment pipeline design.</span>

<span class="sd">        :param terminated: Whether the episode has reached the terminal state</span>
<span class="sd">                           of the MDP at the current step. This flag can be</span>
<span class="sd">                           used to compute a specific terminal reward.</span>
<span class="sd">        :param info: Dictionary of extra information for monitoring.</span>

<span class="sd">        :returns: Aggregated reward for the current step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>
</div>



<span class="c1"># Note that `InterfaceJiminyEnv` must inherit from `InterfaceObserver` before</span>
<span class="c1"># `InterfaceController` to initialize the action space before the observation</span>
<span class="c1"># space since the action itself may be part of the observation.</span>
<span class="c1"># Similarly, `gym.Env` must be last to make sure all the other initialization</span>
<span class="c1"># methods are called first.</span>
<div class="viewcode-block" id="InterfaceJiminyEnv">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv">[docs]</a>
<span class="k">class</span> <span class="nc">InterfaceJiminyEnv</span><span class="p">(</span>
        <span class="n">InterfaceObserver</span><span class="p">[</span><span class="n">Obs</span><span class="p">,</span> <span class="n">EngineObsType</span><span class="p">],</span>  <span class="c1"># type: ignore[type-var]</span>
        <span class="n">InterfaceController</span><span class="p">[</span><span class="n">Act</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">[</span><span class="n">Obs</span><span class="p">,</span> <span class="n">Act</span><span class="p">],</span>
        <span class="n">Generic</span><span class="p">[</span><span class="n">Obs</span><span class="p">,</span> <span class="n">Act</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Observer plus controller interface for both generic pipeline blocks,</span>
<span class="sd">    including environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;render_modes&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;rgb_array&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s1">&#39;human&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_display_available</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]))</span>
    <span class="p">}</span>

    <span class="c1"># FIXME: Re-definition in derived class to stop mypy from complaining about</span>
    <span class="c1"># incompatible types between the multiple base classes.</span>
    <span class="n">action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">[</span><span class="n">Act</span><span class="p">]</span>
    <span class="n">observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">Space</span><span class="p">[</span><span class="n">Obs</span><span class="p">]</span>

    <span class="n">action</span><span class="p">:</span> <span class="n">Act</span>

    <span class="n">simulator</span><span class="p">:</span> <span class="n">Simulator</span>
    <span class="n">robot</span><span class="p">:</span> <span class="n">jiminy</span><span class="o">.</span><span class="n">Robot</span>
    <span class="n">stepper_state</span><span class="p">:</span> <span class="n">jiminy</span><span class="o">.</span><span class="n">StepperState</span>
    <span class="n">robot_state</span><span class="p">:</span> <span class="n">jiminy</span><span class="o">.</span><span class="n">RobotState</span>
    <span class="n">measurements</span><span class="p">:</span> <span class="n">EngineObsType</span>
    <span class="n">is_simulation_running</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span>

    <span class="n">quantities</span><span class="p">:</span> <span class="s2">&quot;QuantityManager&quot;</span>

    <span class="n">log_fieldnames</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldNested</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fielnames associated with all the variables that have been recorded to</span>
<span class="sd">    the telemetry by any of the layer of the whole pipeline environment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_steps</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of simulation steps that has been performed since last reset of</span>
<span class="sd">    the base environment.</span>

<span class="sd">    .. note::</span>
<span class="sd">        The counter is incremented before updating the observation at the end</span>
<span class="sd">        of the step, and consequently, before evaluating the reward and the</span>
<span class="sd">        termination conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Track whether the observation has been refreshed manually since the</span>
        <span class="c1"># last called &#39;_controller_handle&#39;. It typically happens at the end of</span>
        <span class="c1"># every simulation step to return an observation that is consistent</span>
        <span class="c1"># with the updated state of the agent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_observation_refreshed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Store latest engine measurement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement</span> <span class="o">=</span> <span class="n">EngineObsType</span><span class="p">(</span>
            <span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">states</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">(</span>
                <span class="n">agent</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">(</span>
                    <span class="n">q</span><span class="o">=</span><span class="n">pin</span><span class="o">.</span><span class="n">neutral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pinocchio_model</span><span class="p">),</span>
                    <span class="n">v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pinocchio_model</span><span class="o">.</span><span class="n">nv</span><span class="p">))),</span>
            <span class="n">measurements</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">sensor_measurements</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>

        <span class="c1"># Define flattened engine measurement for efficiency</span>
        <span class="n">agent_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">][</span><span class="s1">&#39;agent&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agent_state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_flat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span>
                                  <span class="n">agent_state</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span>
                                  <span class="n">agent_state</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">],</span>
                                  <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Call super to allow mixing interfaces through multiple inheritance</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get log data associated with the ongoing simulation if any, the</span>
<span class="sd">        previous one otherwise.</span>

<span class="sd">        .. seealso::</span>
<span class="sd">            See `Simulator.log_data` documentation for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">log_data</span>

    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the observer-controller.</span>

<span class="sd">        In practice, it only resets the controller and observer update periods.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method must be called once, after the environment has been</span>
<span class="sd">            reset. This is done automatically when calling `reset` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Re-initialize observation and control periods to ill-defined value to</span>
        <span class="c1"># trigger exception if not set properly later on.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe_dt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_dt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># The observation must always be refreshed after setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_observation_refreshed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@no_type_check</span>
    <span class="k">def</span> <span class="nf">_observer_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                         <span class="n">q</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                         <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                         <span class="n">sensor_measurements</span><span class="p">:</span> <span class="n">jiminy</span><span class="o">.</span><span class="n">SensorMeasurementTree</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thin wrapper around user-specified `refresh_observation` method.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method is not supposed to be called manually nor overloaded.</span>

<span class="sd">        :param t: Current simulation time.</span>
<span class="sd">        :param q: Current extended configuration vector of the robot.</span>
<span class="sd">        :param v: Current extended velocity vector of the robot.</span>
<span class="sd">        :param sensor_measurements: Current sensor data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update engine measurement</span>
        <span class="n">measurement_flat</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">sensor_measurements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">multi_array_copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_measurement_flat</span><span class="p">,</span> <span class="n">measurement_flat</span><span class="p">)</span>

        <span class="c1"># Early return if no simulation is running</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_simulation_running</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Reset the quantity manager.</span>
        <span class="c1"># In principle, the internal cache of quantities should be cleared each</span>
        <span class="c1"># time the state of the robot and/or its derivative changes. This is</span>
        <span class="c1"># hard to do because there is no way to detect this specifically at the</span>
        <span class="c1"># time being. However, `_observer_handle` is never called twice in the</span>
        <span class="c1"># exact same state by the engine, so resetting quantities at the</span>
        <span class="c1"># beginning of the method should cover most cases. Yet, quantities</span>
        <span class="c1"># cannot be used reliably in the definition of profile forces because</span>
        <span class="c1"># they are always updated before the controller gets called, no matter</span>
        <span class="c1"># if either one or the other is time-continuous. Hacking the internal</span>
        <span class="c1"># dynamics to clear quantities does not address this issue either.</span>
        <span class="c1"># self.quantities.clear()</span>

        <span class="c1"># Refresh the observation if not already done but only if a simulation</span>
        <span class="c1"># is already running. It would be pointless to refresh the observation</span>
        <span class="c1"># at this point since the controller will be called multiple times at</span>
        <span class="c1"># start. Besides, it would defeat the purpose `_initialize_buffers`,</span>
        <span class="c1"># that is supposed to be executed before `refresh_observation` is being</span>
        <span class="c1"># called for the first time of an episode.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_observation_refreshed</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_observation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The observation space must be invariant.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__is_observation_refreshed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_controller_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                           <span class="n">q</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                           <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                           <span class="n">sensor_measurements</span><span class="p">:</span> <span class="n">jiminy</span><span class="o">.</span><span class="n">SensorMeasurementTree</span><span class="p">,</span>
                           <span class="n">command</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thin wrapper around user-specified `refresh_observation` and</span>
<span class="sd">        `compute_command` methods.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The internal cache of managed quantities is cleared right away</span>
<span class="sd">            systematically, before anything else.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method is not supposed to be called manually nor overloaded.</span>
<span class="sd">            It will be used by the base environment to instantiate a</span>
<span class="sd">            `jiminy.FunctionalController` responsible for both refreshing</span>
<span class="sd">            observations and compute commands of all the way through a given</span>
<span class="sd">            pipeline in the correct order of the blocks to finally sends</span>
<span class="sd">            command motor torques directly to the robot.</span>

<span class="sd">        :param t: Current simulation time.</span>
<span class="sd">        :param q: Current extended configuration vector of the robot.</span>
<span class="sd">        :param v: Current actual velocity vector of the robot.</span>
<span class="sd">        :param sensor_measurements: Current sensor measurements.</span>
<span class="sd">        :param command: Output argument corresponding to motors torques to</span>
<span class="sd">                        apply on the robot. It must be updated by reference</span>
<span class="sd">                        using `[:]` or `np.copyto`.</span>

<span class="sd">        :returns: Motors torques to apply on the robot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Refresh the observation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer_handle</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sensor_measurements</span><span class="p">)</span>

        <span class="c1"># No need to check for breakpoints of the controller because it already</span>
        <span class="c1"># matches the update period by design.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>

        <span class="c1"># Always consider that the observation must be refreshed after calling</span>
        <span class="c1"># &#39;_controller_handle&#39; as it is never called more often than necessary.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_observation_refreshed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_update_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">derived</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;InterfaceJiminyEnv&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically update which blocks are declared as part of the</span>
<span class="sd">        environment pipeline.</span>

<span class="sd">        Internally, this method first unregister all blocks of the old</span>
<span class="sd">        pipeline, then register all blocks of the new pipeline, and finally</span>
<span class="sd">        notify the base environment that the top-most block of the pipeline as</span>
<span class="sd">        changed and must be updated accordingly.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method is not supposed to be called manually nor overloaded.</span>

<span class="sd">        :param derived: Either the top-most block of the pipeline or None.</span>
<span class="sd">                        If None, unregister all blocks of the old pipeline. If</span>
<span class="sd">                        not None, first unregister all blocks of the old</span>
<span class="sd">                        pipeline, then register all blocks of the new pipeline.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceJiminyEnv.stop">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.stop">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the underlying simulation completely.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method has nothing to do with termination and/or truncation of</span>
<span class="sd">            episodes. Calling it manually should never be necessary for</span>
<span class="sd">            collecting samples during training.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method is mainly intended for evaluation analysis and</span>
<span class="sd">            debugging. Stopping the episode is only necessary for switching</span>
<span class="sd">            between training and evaluation mode, and to log the final state,</span>
<span class="sd">            otherwise it will be missing from plots and viewer replay (see</span>
<span class="sd">            `InterfaceJiminyEnv.log_data` for details). Moreover, sensor data</span>
<span class="sd">            will not be available when calling `replay`. The helper method</span>
<span class="sd">            `jiminy_py.viewer.replay.play_logs_data` must be preferred to</span>
<span class="sd">            replay an episode that cannot be stopped.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Resuming a simulation is not supported, which means that calling</span>
<span class="sd">            `reset` to start a new simulation is necessary prior to calling</span>
<span class="sd">            `step` once again. Falling to do so will trigger an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.plot">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.plot">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">enable_block_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TabbedFigure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot figures of simulation data over time associated with the</span>
<span class="sd">        ongoing episode until now if any, the previous one otherwise.</span>

<span class="sd">        :param kwargs: Implementation-specific extra keyword arguments if any.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.replay">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.replay">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">replay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replay the ongoing episode until now if any, the previous one</span>
<span class="sd">        otherwise.</span>

<span class="sd">        :param kwargs: Implementation-specific extra keyword arguments if any.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.evaluate">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.evaluate">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">policy_fn</span><span class="p">:</span> <span class="n">PolicyCallbackFun</span><span class="p">,</span>
                 <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">horizon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">enable_stats</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">enable_replay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">InfoType</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Evaluate a policy on the environment over a complete episode.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            It ignores any top-level `gym.Wrapper` that may be used for</span>
<span class="sd">            training but are not considered part of the environment pipeline.</span>

<span class="sd">        :param policy_fn:</span>
<span class="sd">            .. raw:: html</span>

<span class="sd">                Policy to evaluate as a callback function. It must have the</span>
<span class="sd">                following signature (**rew** = None at reset):</span>

<span class="sd">            | policy_fn\(**obs**: Obs,</span>
<span class="sd">            |            **action_prev**: Optional[Act],</span>
<span class="sd">            |            **reward**: Optional[float],</span>
<span class="sd">            |            **terminated**: bool,</span>
<span class="sd">            |            **truncated**: bool,</span>
<span class="sd">            |            **info**: InfoType</span>
<span class="sd">            |            \) -&gt; Act  # **action**</span>
<span class="sd">        :param seed: Seed of the environment to be used for the evaluation of</span>
<span class="sd">                     the policy.</span>
<span class="sd">                     Optional: `None` by default. If not specified, then a</span>
<span class="sd">                     strongly random seed will be generated by gym.</span>
<span class="sd">        :param horizon: Horizon of the simulation before early termination.</span>
<span class="sd">                        `None` to disable.</span>
<span class="sd">                        Optional: `None` by default.</span>
<span class="sd">        :param enable_stats: Whether to print high-level statistics after the</span>
<span class="sd">                             simulation.</span>
<span class="sd">                             Optional: Enabled by default.</span>
<span class="sd">        :param enable_replay: Whether to enable replay of the simulation, and</span>
<span class="sd">                              eventually recording if the extra</span>
<span class="sd">                              keyword argument `record_video_path` is provided.</span>
<span class="sd">                              Optional: Enabled by default if display is</span>
<span class="sd">                              available, disabled otherwise.</span>
<span class="sd">        :param kwargs: Extra keyword arguments to forward to the `replay`</span>
<span class="sd">                       method if replay is requested.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.play_interactive">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.play_interactive">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">play_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">enable_travelling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">start_paused</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">enable_is_done</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interact evaluation mode where the robot or the world itself are</span>
<span class="sd">        actively &quot;controlled&quot; via keyboard inputs, with real-time rendering.</span>

<span class="sd">        This method is not available for all pipeline environments. When it</span>
<span class="sd">        does, the available interactions and keyboard mapping is completely</span>
<span class="sd">        implementation-specific. Please refer to the documentation of the base</span>
<span class="sd">        environment being considered for details.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            It ignores any top-level `gym.Wrapper` that may be used for</span>
<span class="sd">            training but are not considered part of the pipeline environment.</span>

<span class="sd">        :param enable_travelling: Whether enable travelling, following the</span>
<span class="sd">                                  motion of the root frame of the model. This</span>
<span class="sd">                                  parameter is ignored if the model has no</span>
<span class="sd">                                  freeflyer.</span>
<span class="sd">                                  Optional: Enabled by default iif &#39;panda3d&#39;</span>
<span class="sd">                                  viewer backend is used.</span>
<span class="sd">        :param start_paused: Whether to start in pause.</span>
<span class="sd">                             Optional: Enabled by default.</span>
<span class="sd">        :param verbose: Whether to display status messages.</span>
<span class="sd">        :param kwargs: Implementation-specific extra keyword arguments if any.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.has_terminated">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.has_terminated">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">has_terminated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">InfoType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether the episode is over, because a terminal state of</span>
<span class="sd">        the underlying MDP has been reached or an aborting condition outside</span>
<span class="sd">        the scope of the MDP has been triggered.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method is called after `refresh_observation`, so that the</span>
<span class="sd">            internal buffer &#39;observation&#39; is up-to-date.</span>

<span class="sd">        :param info: Dictionary of extra information for monitoring.</span>

<span class="sd">        :returns: terminated and truncated flags.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.set_wrapper_attr">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.set_wrapper_attr">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_wrapper_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                         <span class="o">*</span><span class="p">,</span>
                         <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign an attribute to a specified value in the first layer of the</span>
<span class="sd">        pipeline environment for which it already exists, from this wrapper to</span>
<span class="sd">        the base environment. If the attribute does not exist in any layer, it</span>
<span class="sd">        is directly added to this wrapper.</span>

<span class="sd">        :param name: Name of the attribute.</span>
<span class="sd">        :param value: Desired value of the attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.train">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.train">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the environment in training or evaluation mode.</span>

<span class="sd">        :param mode: Whether to set training (True) or evaluation mode (False).</span>
<span class="sd">                     Optional: `True` by default.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="InterfaceJiminyEnv.eval">
<a class="viewcode-back" href="../../../../api/gym_jiminy/common/bases/interfaces.html#gym_jiminy.common.bases.interfaces.InterfaceJiminyEnv.eval">[docs]</a>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the environment in evaluation mode.</span>

<span class="sd">        This only has an effect on certain environments. It can be used for</span>
<span class="sd">        instance to enable clipping or filtering of the action at evaluation</span>
<span class="sd">        time specifically. See documentations of a given environment for</span>
<span class="sd">        details about their behaviors in training and evaluation modes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">training</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the environment is in training or evaluation mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@training</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the environment in training or evaluation mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">unwrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BaseJiminyEnv&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The &quot;underlying environment at the basis of the pipeline from which</span>
<span class="sd">        this environment is part of.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">step_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get timestep of a single &#39;step&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Alexis Duburcq - MIT licence.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>